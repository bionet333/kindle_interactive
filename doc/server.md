# Модуль Веб-сервера (`server.rs`)

Этот модуль отвечает за запуск встроенного веб-сервера Axum, который предоставляет контент для E-Ink читалок и обрабатывает запросы на обновление данных от десктопного фронтенда.

## Ответственность

- Инициализация и запуск легковесного HTTP-сервера на порту `5001`.
- Обслуживание эндпоинтов для получения и обновления контента.
- Взаимодействие с общим состоянием приложения (`AppState`).
- Управление CORS-заголовками для обеспечения доступности с любого устройства в сети.
- **Управление кэшированием**: Сервер отправляет заголовки, запрещающие кэширование (`Cache-Control`, `Pragma`, `Expires`), чтобы гарантировать, что читалка всегда получает самую свежую версию контента.

## API Эндпоинты

### `GET /get`

Отдаёт основную HTML-страницу, предназначенную для отображения на E-Ink устройствах. В шаблон встраивается первоначальный контент и его хэш, чтобы избежать дополнительного запроса при первой загрузке.

### `GET /api/content`

API-эндпоинт, который используется JavaScript-кодом на странице `/get` для проверки наличия обновлений. 

- **Ответ**: `application/json`
- **Структура JSON ответа**:
  ```json
  {
    "html": "...",
    "hash": "..."
  }
  ```

### `POST /api/content`

Принимает новый текст от десктопного редактора и обновляет общее состояние.

- **Запрос**: `application/json`
- **Структура JSON запроса**:
  ```json
  {
    "new_text": "..."
  }
  ```
- **Логика**: Блокирует `AppState` на запись и заменяет текущий текст новым.

### `POST /api/url`

Принимает URL для обработки, извлечения контента и обновления общего состояния.

- **Запрос**: `application/json`
- **Структура JSON запроса**:
  ```json
  {
    "url": "..."
  }
  ```
- **Логика**: 
    1. Вызывает асинхронную функцию `url_processor::process_url`.
    2. В случае успеха, блокирует `AppState` на запись и заменяет текст на полученный Markdown.
    3. В случае ошибки, возвращает JSON с сообщением об ошибке.

## Архитектурные решения

- **Axum**: Выбран как современный, быстрый и модульный веб-фреймворк для Rust.
- **Одно общее состояние (`Arc<AppState>`)**: Сервер работает с тем же состоянием, что и команды Tauri, обеспечивая мгновенную синхронизацию.
- **Асинхронность**: Сервер запускается в отдельном асинхронном потоке (`tauri::async_runtime::spawn`), не блокируя основной поток UI.
